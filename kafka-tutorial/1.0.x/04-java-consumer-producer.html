<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Developing Consumers and Producers in Java :: Kafka Tutorial</title>
    <link rel="canonical" href="https://redhat-cloud-services-tmm.github.io/kafka-tutorial/kafka-tutorial/1.0.x/04-java-consumer-producer.html">
    <link rel="prev" href="03-consumers-producers.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img src="../../_/img/NewRHDFullLogo_4-color_white-wordmark.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="https://redhat-cloud-services-tmm.github.io/kafka-tutorial">Kafka Tutorial</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="kafka-tutorial" data-version="1.0.x">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html"></a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#downloadconfiguresources">Download &amp; Configure Tutorial</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#redhataccount">Create a Red Hat Account</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#kafka">Provision a Kafka Instance</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#serviceaccount">Create a Service Account</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#serviceaccountpermissions">Set Permissions for the Service Account</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#verifykafka">Verify the Kafka instance</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="02-topics-partitions.html">2. Topics &amp; Partitions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-topics-partitions.html#topics">Topics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-topics-partitions.html#partitions">Partitions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-topics-partitions.html#messages">Messages</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-topics-partitions.html#topic-creation">Create a Topic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-topics-partitions.html#topic-info">Topic Information</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="03-consumers-producers.html">3. Consumer &amp; Producers</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-consumers-producers.html#producer">Producer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-consumers-producers.html#consumer">Consumer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-consumers-producers.html#consume-kafkacat">Kafkacat Consumer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-consumers-producers.html#produce-kafkacat">Kafkacat Producer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-consumers-producers.html#playingwithoffsets">Kafkacat Offsets</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-consumers-producers.html#changingretention">Changing Retention</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="04-java-consumer-producer.html">4. Developing Consumers and Producers in Java</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#topic-creation">Create a Topic</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#producer-java">Producing messages with Java</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#deploying-producer">Deploying Producer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="#consumer-java">Consuming messages with Java</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#deploying-consumer">Deploying Consumer</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#produce-consume-songs">Produce and Consume Songs</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Kafka Tutorial</a></li>
    <li><a href="04-java-consumer-producer.html">4. Developing Consumers and Producers in Java</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Developing Consumers and Producers in Java</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this lab, we are going to develop an example where there is one service that is producing song descriptions to the <code>songs-catalog</code> topic.</p>
</div>
<div class="paragraph">
<p>Then there is another service that consumes these song descriptions from the <code>songs-catalog</code> topics.
Notice that in real life this consumer would take the songs and process them (i.e adding them in a graph database like Neo4J, or an ElasticSearch for searching capabilities), but for the sake of simplicity, in this case, the service is printing them in the console.</p>
</div>
<div class="paragraph">
<p>You need to open 4 terminal windows to run this example, 2 terminals for running the services, and 2 terminals for sending requests.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/terminals-song.png" alt="terminals song">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="topic-creation"><a class="anchor" href="#topic-creation"></a>Create a Topic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Refer to the <a href="02-topics-partitions.html#topic-creation" class="xref page">Create a Topic</a> section to create a new topic on your OpenShift Streams for Apache Kafka instance.</p>
</div>
<div class="paragraph">
<p>Use <code>songs-catalog</code> as topic name.</p>
</div>
<div class="paragraph">
<p>Keep the number of partitions to 1.</p>
</div>
<div class="paragraph">
<p>Keep the default message retention values.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="producer-java"><a class="anchor" href="#producer-java"></a>Producing messages with Java</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The producer code is at <a href="https://github.com/redhat-cloud-services-tmm/kafka-tutorial/blob/main/apps/song-app/quarkus/song-app" target="_blank" rel="noopener">Song App</a>.</p>
</div>
<div class="sect2">
<h3 id="deploying-producer"><a class="anchor" href="#deploying-producer"></a>Deploying Producer</h3>
<div class="paragraph">
<p>In this case, the Quarkus service to produce songs is deployed.
You&#8217;ve got two options, using Docker or building the service yourself.
In terminal 1, run one of these two options:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset1_building-amp-run"></a>Building &amp; Run</p>
</li>
<li>
<p><a id="tabset1_docker"></a>Docker</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset1_building-amp-run">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash-shell hljs" data-lang="bash-shell">source $TUTORIAL_HOME/apps/env
cd $TUTORIAL_HOME/apps/song-app/quarkus/song-app
./mvnw clean package -DskipTests</code></pre>
</div>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash-shell hljs" data-lang="bash-shell">docker build -t quay.io/cloudservicestmm/kafka-tutorial-song-app:quarkus -f src/main/docker/Dockerfile.jvm .</code></pre>
</div>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash-shell hljs" data-lang="bash-shell">docker run --rm -ti -p 8080:8080 -e BOOTSTRAP_SERVER=$BOOTSTRAP_SERVER -e CLIENT_ID=$CLIENT_ID -e CLIENT_SECRET=$CLIENT_SECRET quay.io/cloudservicestmm/kafka-tutorial-song-app:quarkus</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash-shell hljs" data-lang="bash-shell">_  ____  __  _____   ___  __ ____  ______
 --/ __ \/ / / / _ | / _ \/ //_/ / / / __/
 -/ /_/ / /_/ / __ |/ , _/ ,&lt; / /_/ /\ \
--\___\_\____/_/ |_/_/|_/_/|_|\____/___/
2021-11-10 16:37:37,618 INFO  [org.apa.kaf.com.sec.aut.AbstractLogin] (main) Successfully logged in.
2021-11-10 16:37:37,780 INFO  [io.sma.rea.mes.kafka] (main) SRMSG18258: Kafka producer kafka-producer-songs, connected to Kafka brokers 'bernard-c---pv-dartaq-c---ba.bf2.kafka.rhcloud.com:443', is configured to write records to 'songs-catalog'
2021-11-10 16:37:37,971 INFO  [io.quarkus] (main) song-app 1.0.0-SNAPSHOT on JVM (powered by Quarkus 2.4.1.Final) started in 1.522s. Listening on: <a href="http://0.0.0.0:8080" class="bare">http://0.0.0.0:8080</a>
2021-11-10 16:37:37,971 INFO  [io.quarkus] (main) Profile prod activated.
2021-11-10 16:37:37,972 INFO  [io.quarkus] (main) Installed features: [cdi, kafka-client, kubernetes, resteasy, resteasy-jsonb, smallrye-context-propagation, smallrye-health, smallrye-reactive-messaging, smallrye-reactive-messaging-kafka, vertx]</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset1_docker">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash-shell hljs" data-lang="bash-shell">source $TUTORIAL_HOME/apps/env
docker run --rm -ti -p 8080:8080 -e BOOTSTRAP_SERVER=$BOOTSTRAP_SERVER -e CLIENT_ID=$CLIENT_ID -e CLIENT_SECRET=$CLIENT_SECRET quay.io/cloudservicestmm/kafka-tutorial-song-app:quarkus</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash-shell hljs" data-lang="bash-shell">_  ____  __  _____   ___  __ ____  ______
 --/ __ \/ / / / _ | / _ \/ //_/ / / / __/
 -/ /_/ / /_/ / __ |/ , _/ ,&lt; / /_/ /\ \
--\___\_\____/_/ |_/_/|_/_/|_|\____/___/
2021-11-10 16:37:37,618 INFO  [org.apa.kaf.com.sec.aut.AbstractLogin] (main) Successfully logged in.
2021-11-10 16:37:37,780 INFO  [io.sma.rea.mes.kafka] (main) SRMSG18258: Kafka producer kafka-producer-songs, connected to Kafka brokers 'bernard-c---pv-dartaq-c---ba.bf2.kafka.rhcloud.com:443', is configured to write records to 'songs-catalog'
2021-11-10 16:37:37,971 INFO  [io.quarkus] (main) song-app 1.0.0-SNAPSHOT on JVM (powered by Quarkus 2.4.1.Final) started in 1.522s. Listening on: <a href="http://0.0.0.0:8080" class="bare">http://0.0.0.0:8080</a>
2021-11-10 16:37:37,971 INFO  [io.quarkus] (main) Profile prod activated.
2021-11-10 16:37:37,972 INFO  [io.quarkus] (main) Installed features: [cdi, kafka-client, kubernetes, resteasy, resteasy-jsonb, smallrye-context-propagation, smallrye-health, smallrye-reactive-messaging, smallrye-reactive-messaging-kafka, vertx]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="consumer-java"><a class="anchor" href="#consumer-java"></a>Consuming messages with Java</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The consumer code is at <a href="https://github.com/redhat-cloud-services-tmm/kafka-tutorial/blob/main/apps/song-indexer-app/quarkus/song-indexer-app" target="_blank" rel="noopener">Song Indexer App</a>.</p>
</div>
<div class="sect2">
<h3 id="deploying-consumer"><a class="anchor" href="#deploying-consumer"></a>Deploying Consumer</h3>
<div class="paragraph">
<p>In this case, the Quarkus service to consume songs is deployed.
You&#8217;ve got two options, using Docker or building the service yourself.
In terminal 2, run one of these two options:</p>
</div>
<div class="tabset is-loading">
<div class="ulist tabs">
<ul>
<li>
<p><a id="tabset2_build-amp-run"></a>Build &amp; Run</p>
</li>
<li>
<p><a id="tabset2_docker"></a>Docker</p>
</li>
</ul>
</div>
<div class="content">
<div class="tab-pane" aria-labelledby="tabset2_build-amp-run">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash-shell hljs" data-lang="bash-shell">source $TUTORIAL_HOME/apps/env
cd $TUTORIAL_HOME/apps/song-indexer-app/quarkus/song-indexer-app
./mvnw clean package -DskipTests</code></pre>
</div>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash-shell hljs" data-lang="bash-shell">docker build -t quay.io/cloudservicestmm/kafka-tutorial-song-indexer-app:quarkus -f src/main/docker/Dockerfile.jvm .</code></pre>
</div>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash-shell hljs" data-lang="bash-shell">docker run --rm -ti -p 9090:8080 -e BOOTSTRAP_SERVER=$BOOTSTRAP_SERVER -e CLIENT_ID=$CLIENT_ID -e CLIENT_SECRET=$CLIENT_SECRET quay.io/cloudservicestmm/kafka-tutorial-song-indexer-app:quarkus</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash-shell hljs" data-lang="bash-shell">__  ____  __  _____   ___  __ ____  ______
 --/ __ \/ / / / _ | / _ \/ //_/ / / / __/
 -/ /_/ / /_/ / __ |/ , _/ ,&lt; / /_/ /\ \
--\___\_\____/_/ |_/_/|_/_/|_|\____/___/
2021-11-10 17:35:00,733 INFO  [io.sma.rea.mes.kafka] (main) SRMSG18229: Configured topics for channel 'songs': [songs-catalog]
2021-11-10 17:35:00,965 INFO  [org.apa.kaf.com.sec.aut.AbstractLogin] (main) Successfully logged in.
2021-11-10 17:35:01,218 INFO  [io.quarkus] (main) song-indexer-app 1.0.0-SNAPSHOT on JVM (powered by Quarkus 2.4.1.Final) started in 1.358s. Listening on: <a href="http://0.0.0.0:8080" class="bare">http://0.0.0.0:8080</a>
2021-11-10 17:35:01,219 INFO  [io.quarkus] (main) Profile prod activated.
2021-11-10 17:35:01,219 INFO  [io.quarkus] (main) Installed features: [cdi, kafka-client, kubernetes, resteasy, resteasy-jsonb, resteasy-mutiny, smallrye-context-propagation, smallrye-health, smallrye-reactive-messaging, smallrye-reactive-messaging-kafka, vertx]</code></pre>
</div>
</div>
</div>
<div class="tab-pane" aria-labelledby="tabset2_docker">
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash-shell hljs" data-lang="bash-shell">docker run --rm -ti -p 9090:8080 -e BOOTSTRAP_SERVER=$BOOTSTRAP_SERVER -e CLIENT_ID=$CLIENT_ID -e CLIENT_SECRET=$CLIENT_SECRET quay.io/cloudservicestmm/kafka-tutorial-song-indexer-app:quarkus</code></pre>
</div>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash-shell hljs" data-lang="bash-shell">__  ____  __  _____   ___  __ ____  ______
 --/ __ \/ / / / _ | / _ \/ //_/ / / / __/
 -/ /_/ / /_/ / __ |/ , _/ ,&lt; / /_/ /\ \
--\___\_\____/_/ |_/_/|_/_/|_|\____/___/
2021-11-10 17:35:00,733 INFO  [io.sma.rea.mes.kafka] (main) SRMSG18229: Configured topics for channel 'songs': [songs-catalog]
2021-11-10 17:35:00,965 INFO  [org.apa.kaf.com.sec.aut.AbstractLogin] (main) Successfully logged in.
2021-11-10 17:35:01,218 INFO  [io.quarkus] (main) song-indexer-app 1.0.0-SNAPSHOT on JVM (powered by Quarkus 2.4.1.Final) started in 1.358s. Listening on: <a href="http://0.0.0.0:8080" class="bare">http://0.0.0.0:8080</a>
2021-11-10 17:35:01,219 INFO  [io.quarkus] (main) Profile prod activated.
2021-11-10 17:35:01,219 INFO  [io.quarkus] (main) Installed features: [cdi, kafka-client, kubernetes, resteasy, resteasy-jsonb, resteasy-mutiny, smallrye-context-propagation, smallrye-health, smallrye-reactive-messaging, smallrye-reactive-messaging-kafka, vertx]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="produce-consume-songs"><a class="anchor" href="#produce-consume-songs"></a>Produce and Consume Songs</h3>
<div class="paragraph">
<p>Song Indexer Service is exposing using Server-Side Events, the songs that are published to the <code>songs-catalog</code> topic.
In the terminal 3, run the following command to start listening for the events:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash-shell hljs" data-lang="bash-shell">http GET localhost:9090/events --stream --timeout=600</code></pre>
</div>
</div>
<div class="paragraph">
<p>Song Service exposes an endpoint to publish songs into the <code>songs-catalog</code> topic.
In the terminal 4, run the following command to publish a song:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash-shell hljs" data-lang="bash-shell">http POST localhost:8080/songs id=1000 name=Portals author='Alan Silvestri'</code></pre>
</div>
</div>
<div class="listingblock console-ouput">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash-shell hljs" data-lang="bash-shell">HTTP/1.1 201 Created
content-length: 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>To verify that the song has been processed, check terminal 2 (<code>song indexer service</code>) for the next logline:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash-shell hljs" data-lang="bash-shell">Song {"author":"Alan Silvestri","id":1000,"name":"Portals","op":"ADD"} indexed</code></pre>
</div>
</div>
<div class="paragraph">
<p>And in the termianl 3, you should see that en event has been streamed:</p>
</div>
<div class="listingblock console-output">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash-shell hljs" data-lang="bash-shell">data: {
    kafka-tutorial/kafka-tutorial-rhosak [main L|✚ 2…6⚑ 1]
    "author": "Alan Silvestri",
    "id": 1000,
    "name": "Portals",
    "op": "ADD"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="java-cleanup"><a class="anchor" href="#java-cleanup"></a>Clean Up</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Stop the processes that are running in the terminal 1,2 and 3 by typing <span class="keyseq"><kbd>Ctrl</kbd>+<kbd>C</kbd></span>.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="03-consumers-producers.html">3. Consumer &amp; Producers</a></span>
</nav>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
